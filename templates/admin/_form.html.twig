{% trans_default_domain 'SymkitPageBundle' %}
{% set page = form.vars.data %}
{% set is_edit = page.id is not null %}

{{ form_start(form, {attr: {id: 'page-form'}}) }}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
    {# Main Column (Left) #}
    <div class="lg:col-span-3 space-y-8">
        {# Permalink (Outside and Above) #}
        {% if form.slug is defined %}
        <div class="px-1 flex items-center gap-x-2 text-sm text-gray-500 dark:text-gray-400">
            <span class="font-medium shrink-0">{{ 'admin.page.permalink'|trans }}</span>
            <div class="flex items-center gap-1 min-w-0">
                <span class="shrink-0">{{ app.request.schemeAndHttpHost }}/</span>
                <span
                    class="shrink min-w-0 [&_div]:mt-0 [&_input]:py-0 [&_input]:h-auto [&_input]:border-0 [&_input]:bg-gray-100/50 [&_input]:dark:bg-white/5 [&_input]:rounded [&_input]:px-1 [&_input]:inline-block [&_input]:w-auto [&_input]:min-w-[100px]">
                    {{ form_widget(form.slug, {attr: {
                    'oninput': 'document.getElementById("view-page-link").href = "' ~
                    app.request.schemeAndHttpHost
                    ~ '/" + this.value'
                    }}) }}
                </span>
            </div>
            {% if is_edit %}
            <a id="view-page-link" href="{{ path('page_show', {slug: page.slug}) }}" target="_blank"
                class="shrink-0 flex items-center gap-1 text-indigo-600 hover:text-indigo-500 font-bold ml-2">
                {{ ux_icon('heroicons:arrow-top-right-on-square-20-solid', {class: 'w-4 h-4'}) }}
                <span>{{ 'admin.page.open'|trans }}</span>
            </a>
            {% endif %}
            {{ form_errors(form.slug) }}
        </div>
        {% endif %}

        {# General Information Card #}
        <div
            class="bg-white dark:bg-gray-800/50 shadow-sm rounded-lg border border-gray-100 dark:border-white/5 overflow-hidden">
            <div
                class="px-4 py-3 bg-gray-50/50 dark:bg-white/5 border-b border-gray-100 dark:border-white/5 flex items-center justify-between">
                <h3 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider">{{ 'admin.page.general_info'|trans }}</h3>
            </div>
            <div class="p-6 space-y-6">
                {# Title #}
                <div>
                    {{ form_row(form.title, {attr: {
                    class: 'text-3xl font-bold border-0 border-b border-transparent focus:border-indigo-600
                    dark:focus:border-indigo-500 px-0 rounded-none shadow-none bg-transparent',
                    placeholder: 'admin.page.add_title'|trans
                    }}) }}
                </div>

                {# Excerpt #}
                <div class="pt-2">
                    {{ form_row(form.excerpt) }}
                </div>
            </div>
        </div>

        {# Content Editor #}
        <div
            class="bg-white dark:bg-gray-800/50 shadow-sm rounded-lg border border-gray-100 dark:border-white/5 overflow-hidden">
            <div
                class="px-4 py-3 bg-gray-50/50 dark:bg-white/5 border-b border-gray-100 dark:border-white/5 flex items-center justify-between">
                <h3 class="text-sm font-semibold text-gray-900 dark:text-white uppercase tracking-wider">{{ 'admin.page.content'|trans }}</h3>
                <span class="text-xs text-gray-500 font-mono">{{ 'admin.page.visual_editor'|trans }}</span>
            </div>
            <div class="p-6">
                <div class="hidden">
                    {{ form_widget(form.content, { required: false }) }}
                </div>

                {{ component('content_builder', {
                initialContent: page.content|default(''),
                inputName: form.content.vars.full_name
                }) }}
            </div>
        </div>

        {% block extra_main_content %}{% endblock %}
    </div>

    {# Sidebar Column (Right) #}
    <div class="space-y-6">
        {# Status Summary Card #}
        <div
            class="bg-white dark:bg-gray-800/50 shadow-sm rounded-lg border border-gray-100 dark:border-white/5 relative focus-within:z-20">
            <div class="px-4 py-3 bg-gray-50/50 dark:bg-white/5 border-b border-gray-100 dark:border-white/5">
                <h3 class="text-xs font-semibold text-gray-900 dark:text-white uppercase tracking-wider">{{ 'admin.page.status_visibility'|trans }}</h3>
            </div>
            <div class="p-4 space-y-4">
                {{ form_row(form.status) }}
                {{ form_row(form.category) }}
                {{ form_row(form.faq) }}
            </div>
        </div>

        {# Image & SEO Card #}
        <div
            class="bg-white dark:bg-gray-800/50 shadow-sm rounded-lg border border-gray-100 dark:border-white/5 relative focus-within:z-20">
            <div class="px-4 py-3 bg-gray-50/50 dark:bg-white/5 border-b border-gray-100 dark:border-white/5">
                <h3 class="text-xs font-semibold text-gray-900 dark:text-white uppercase tracking-wider">{{ 'admin.page.seo_metadata'|trans }}</h3>
            </div>
            <div class="p-4 space-y-4">
                {{ form_row(form.ogImage) }}
                {{ form_row(form.metaTitle) }}
                {{ form_row(form.metaDescription) }}
            </div>
        </div>

        {# Layout Settings Card #}
        <div
            class="bg-white dark:bg-gray-800/50 shadow-sm rounded-lg border border-gray-100 dark:border-white/5 relative focus-within:z-20">
            <div class="px-4 py-3 bg-gray-50/50 dark:bg-white/5 border-b border-gray-100 dark:border-white/5">
                <h3 class="text-xs font-semibold text-gray-900 dark:text-white uppercase tracking-wider">{{ 'admin.page.layout_navigation'|trans }}</h3>
            </div>
            <div class="p-4 space-y-4">
                {{ form_row(form.template) }}
                {{ form_row(form.sidebarLeftMenu) }}
                {{ form_row(form.activeMenu) }}
                {{ form_row(form.activeMenuItem) }}
            </div>
        </div>

        {% block extra_sidebar %}{% endblock %}

        {# Danger Zone (Only on edit) #}
        {% if is_edit %}
        <div>
            <button type="button" onclick="document.getElementById('delete-page-form').requestSubmit();"
                class="w-full cursor-pointer rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600 transition-colors">
                {{ 'admin.page.delete_button'|trans }}
            </button>
        </div>
        {% endif %}
    </div>
</div>
{{ form_end(form) }}